# 更新日志

## [1.3.0] - 2025-10-30

### 🎯 重大重构

#### 数据管理抽离

- **新增 useWorkflow Composable**
  - 创建 `src/views/test/composables/useWorkflow.ts`
  - 将所有节点和连线的增删改查操作抽离到 composable 中
  - 提供统一的操作结果类型 `OperationResult`
  - 支持业务逻辑回调机制 `OperationCallback`

- **主页面重构**
  - `vueflow.vue` 现在使用 `useWorkflow` composable
  - 移除直接使用 `useVueFlow` 的数据操作
  - 所有操作都通过 workflow 方法进行
  - 代码更加清晰和可维护

#### 新增功能

**节点操作（5个方法）**

- `addNode` - 添加节点（支持业务逻辑回调）
- `updateNode` - 更新节点（支持业务逻辑回调）
- `deleteNode` - 删除节点（支持业务逻辑回调）
- `batchDeleteNodes` - 批量删除节点
- `cloneNode` - 克隆节点（支持业务逻辑回调）

**连线操作（3个方法）**

- `addEdge` - 添加连线（支持业务逻辑回调）
- `updateEdge` - 更新连线（支持业务逻辑回调）
- `deleteEdge` - 删除连线（支持业务逻辑回调）

**批量操作（4个方法）**

- `selectAllNodes` - 全选节点
- `clearCanvas` - 清空画布（支持业务逻辑回调）
- `importData` - 导入数据（支持业务逻辑回调）
- `exportData` - 导出数据（支持业务逻辑回调）

**查询操作（7个方法）**

- `getAllNodes` - 获取所有节点
- `getAllEdges` - 获取所有连线
- `getNodeById` - 根据ID查找节点
- `getEdgeById` - 根据ID查找连线
- `getNodesByType` - 根据类型查找节点
- `getSelectedNodes` - 获取选中的节点
- `setSelectedNodeId` - 设置选中节点

#### 业务逻辑控制

所有操作都支持可选的业务逻辑回调：

```typescript
await workflow.addNode(NodeTypeEnum.PROCESS, { x: 100, y: 100 }, async () => {
  // 你的业务逻辑
  // 只有返回 { success: true } 时才会真正执行
  return { success: true };
});
```

#### 文档和示例

- **API 文档**: `src/views/test/composables/README.md`
- **使用示例**: `src/views/test/composables/useWorkflow.example.ts`
  - 13 个实际场景的完整代码示例
  - 包含验证、确认、错误处理等最佳实践

### 🔧 技术改进

- 统一的错误处理机制
- 自动消息提示（成功/失败）
- 完整的 TypeScript 类型支持
- 更好的代码组织和可维护性
- 支持异步业务逻辑

### 📝 破坏性变更

- 主页面不再直接暴露 `nodes` 和 `edges` ref
- 改为通过 `workflow.getAllNodes()` 和 `workflow.getAllEdges()` 获取
- 所有数据操作方法都改为异步

---

## [1.2.1] - 2025-10-30

### 🎨 样式优化

#### 暗黑模式适配

- **右键菜单 (ContextMenu)**
  - 添加 `darkMode` prop 支持
  - 暗黑模式下使用深色背景 (#2d3748)
  - 优化菜单项颜色和悬停效果
  - 危险操作使用深红色背景
  - 快捷键文字颜色适配

- **节点面板 (NodePalette)**
  - 添加 `darkMode` prop 支持
  - 暗黑模式下使用深色背景和边框
  - 优化节点卡片样式
  - 调整滚动条颜色
  - 删除区域使用深红色主题

- **属性面板 (PropertiesPanel)**
  - 添加 `darkMode` prop 支持
  - 暗黑模式下使用深色背景
  - 优化表单输入框样式
  - 适配 Element Plus 组件暗黑模式
  - 调整滚动条和分割线颜色

- **主容器**
  - 添加背景色过渡动画
  - 优化暗黑模式切换体验

### 🔧 技术改进

#### 组件通信

- 主页面通过 `darkMode` prop 传递暗黑模式状态
- 所有子组件统一响应暗黑模式切换
- 移除 CSS `@media (prefers-color-scheme: dark)` 改用 class 控制

#### 样式一致性

- 统一暗黑模式配色方案
  - 主背景: #2d3748
  - 次背景: #374151
  - 深背景: #1a202c
  - 边框: #4a5568
  - 文字: #e2e8f0
  - 次要文字: #a0aec0
- 统一悬停和激活状态样式

---

## [1.2.0] - 2025-10-30

### ✨ 新功能

#### 右键菜单组件

- **新增 `ContextMenu.vue` 组件**
  - 支持画布、节点、连线三种右键菜单类型
  - 使用 Teleport 渲染到 body，避免层级问题
  - 自动边界检测，防止菜单超出视口
  - 支持暗黑模式

- **画布右键菜单功能**
  - 🔍 放大 (Ctrl +)
  - 🔍 缩小 (Ctrl -)
  - 📐 适应画布 (Ctrl 0)
  - 🔄 重置视图
  - ✅ 全选 (Ctrl A)
  - 🗑️ 清空画布

- **节点右键菜单功能**
  - ✏️ 编辑属性
  - 📋 复制节点 (Ctrl C) - 复制到剪贴板
  - 📑 克隆节点 (Ctrl D) - 快速复制
  - 🔌 切换连接状态
  - 🗑️ 删除节点 (Delete)

- **连线右键菜单功能**
  - ✏️ 编辑标签
  - 🎬 切换动画
  - 🗑️ 删除连接 (Delete)

### 🎨 UI/UX 优化

#### 菜单样式

- 现代化设计，圆角 6px
- 柔和阴影效果
- 平滑的淡入淡出动画
- 悬停状态高亮
- 危险操作红色标识

#### 交互体验

- 显示快捷键提示
- 菜单项图标可视化
- 点击外部自动关闭
- 防止菜单超出屏幕

### 🔧 技术实现

#### 事件处理

- 集成 VueFlow 的右键事件
  - `@pane-context-menu` - 画布右键
  - `@node-context-menu` - 节点右键
  - `@edge-context-menu` - 连线右键
- 阻止默认浏览器右键菜单

#### 功能增强

- 新增节点克隆功能
- 新增节点复制到剪贴板
- 新增全选节点功能
- 新增连线标签编辑
- 新增连线动画切换

---

## [1.1.1] - 2025-10-30

### 🐛 Bug 修复

#### 动画问题修复

- **节点面板收起动画**
  - 修复了收起时没有动画的问题
  - 为 `.palette-content` 添加了 `max-height: 204px`
  - 优化了 transition 动画配置
  - 添加 `!important` 确保动画状态正确应用
  - 现在展开和收起都有平滑的动画效果

---

## [1.1.0] - 2025-10-30

### 🎨 样式优化

#### 面板尺寸调整

- **属性面板（右侧）**
  - 宽度从 360px 调整为 320px
  - 收起时宽度从 48px 调整为 32px
  - 切换按钮宽度从 48px 调整为 32px
  - 图标大小从 18px 调整为 16px
  - 定位从 `fixed` 改为 `absolute`，适配相对定位的容器
  - z-index 从 1000 调整为 100

- **节点面板（底部）**
  - 宽度从 800px 调整为 700px
  - 最大高度从 280px 调整为 240px
  - 收起时高度从 48px 调整为 36px
  - 切换按钮高度从 48px 调整为 36px
  - 图标大小从 18px 调整为 14px
  - 定位从 `fixed` 改为 `absolute`，适配相对定位的容器
  - z-index 从 1000 调整为 100
  - 添加 `max-width: calc(100% - 400px)` 避免与侧边栏重叠

#### 内容间距优化

- **属性面板**
  - 头部 padding 从 20px 24px 调整为 16px 20px
  - 标题字体从 16px 调整为 14px
  - 表单 padding 从 24px 调整为 20px
  - 表单项间距从 20px 调整为 16px
  - 空状态图标从 64px 调整为 48px
  - 空状态文字从 16px 调整为 14px
  - 滚动条宽度从 6px 调整为 4px

- **节点面板**
  - 头部 padding 从 16px 24px 12px 调整为 12px 20px 8px
  - 标题字体从 14px 调整为 13px
  - 副标题字体从 12px 调整为 11px
  - 节点列表 padding 从 16px 24px 调整为 12px 20px
  - 节点项 padding 从 12px 调整为 10px
  - 节点图标从 24px 调整为 20px
  - 节点标签从 14px 调整为 13px
  - 节点描述从 12px 调整为 11px
  - 滚动条宽度从 6px 调整为 4px

#### 删除区域调整

- 顶部偏移从 48px 调整为 36px
- 图标大小从 48px 调整为 36px
- 文字大小从 16px 调整为 14px
- 圆角从 12px 调整为 8px

#### 主容器调整

- **flow-container**
  - 宽度从 `100vw` 改为 `100%`
  - 高度从 `100vh` 改为 `100%`
  - 保持 `position: relative`，支持绝对定位的子元素

#### 控制按钮优化

- 按钮尺寸从 40px × 40px 调整为 36px × 36px
- 图标大小从 20px 调整为 18px

#### MiniMap 调整

- 缩放比例从 75% 调整为 70%
- 原点从 `bottom right` 改为 `bottom left`（避免与属性面板重叠）
- 圆角从 8px 调整为 6px

### 🔧 技术改进

#### 定位方式优化

- 所有面板从 `position: fixed` 改为 `position: absolute`
- 确保面板相对于 `.flow-container` 定位，而不是相对于视口
- 这样可以更好地嵌入到其他页面布局中

#### 阴影和边框优化

- 属性面板阴影从 `-4px 0 20px rgba(0,0,0,0.15)` 调整为 `-2px 0 12px rgba(0,0,0,0.1)`
- 节点面板阴影从 `0 -4px 20px rgba(0,0,0,0.15)` 调整为 `0 -2px 12px rgba(0,0,0,0.1)`
- 节点项阴影从 `0 4px 12px` 调整为 `0 2px 8px`
- 整体视觉更加轻盈

#### 圆角统一

- 大部分圆角从 8px/12px 调整为 6px
- 保持视觉一致性

### 📐 布局改进

#### 响应式优化

- 节点面板添加 `max-width: calc(100% - 400px)`
- 确保在窄屏幕下不会与属性面板重叠
- 节点列表网格从 `minmax(180px, 1fr)` 调整为 `minmax(160px, 1fr)`

#### 空间利用

- 减小各种间距和 padding，提高空间利用率
- 保持视觉舒适度的同时，显示更多内容

### 🎯 用户体验提升

#### 视觉层次

- 通过调整字体大小和间距，优化视觉层次
- 重要信息更突出，次要信息更紧凑

#### 交互反馈

- 保持所有动画和过渡效果
- 优化悬停和点击状态

#### 性能优化

- 减小阴影和模糊效果，提升渲染性能
- 保持流畅的 60fps 动画

---

## [1.0.0] - 2025-10-30

### ✨ 初始版本

#### 核心功能

- ✅ 6种节点类型（开始、结束、流程、判断、并行、自定义）
- ✅ 拖拽式节点添加
- ✅ 可视化连接编辑
- ✅ 属性面板编辑
- ✅ 节点面板管理
- ✅ 暗黑模式支持
- ✅ 数据导出功能

#### 组件架构

- ✅ 模块化组件设计
- ✅ TypeScript 类型安全
- ✅ Vue 3 Composition API
- ✅ Element Plus UI 集成

#### 文档

- ✅ 快速开始指南
- ✅ 使用手册
- ✅ 项目结构文档
- ✅ 组件 API 文档

---

## 版本说明

### 版本号规则

遵循语义化版本 (Semantic Versioning)：

- **主版本号**：不兼容的 API 修改
- **次版本号**：向下兼容的功能性新增
- **修订号**：向下兼容的问题修正

### 更新类型标识

- 🎨 样式优化
- ✨ 新功能
- 🐛 Bug 修复
- 🔧 技术改进
- 📚 文档更新
- ⚡ 性能优化
- 🔒 安全修复
- 🗑️ 废弃功能

---

**最后更新**: 2025-10-30  
**维护者**: QC Admin Team
